<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
<script src="https://cdn.plot.ly/plotly-1.2.0.min.js"></script>
<script src="openzh_covid19.js"></script>
</head>
<body>
<div id="plot" style="width:100%; height:600px;"></div>

<script>

function makeplot() {
 	Plotly.d3.csv("https://www.experimental.bfs.admin.ch/bfsstatic/dam/assets/13407769/master",
		function(data){
			processData(data)
		}
	);
};
	
function processData(rows) {
	var dates = [];
	var covid_codes = [];

	for (var i=0; i<rows.length; i++) {
		row = rows[i];
		dates.push(row['date']);
		covid_codes.push(row['entered_codes_total']);
	}
	makePlotly(dates, covid_codes);
	getOpenZhCovid19Data('ncumul_conf', function(total_dates, total_data) {
		total_cases_sum = sumCantonalData(total_data);
		total_cases_inc = diffData(total_cases_sum);

		daily_cases = [];

		for (let i = 0; i < dates.length; ++i) {
			let d_index = total_dates.indexOf(dates[i]);
			if (d_index >= 0) {
				daily_cases.push(total_cases_inc[d_index]);
			}
		}

		var plotDiv = document.getElementById("plot");
		var trace = {
			x: dates,
			y: daily_cases,
			name: 'Confirmed COVID-19 cases',
			type: 'bar',
		};

		Plotly.addTraces(plotDiv, trace);
	});
}

function makePlotly(dates, covid_codes){
	var traces = [{
		x: dates,
		y: covid_codes,
		name: 'Entered covid codes',
		type: 'bar',
	},
	];

	var layout = {
		title: 'BAG COVID-19 SwissCovid entered covid codes',
	};

	Plotly.newPlot('plot', traces, layout);
};

makeplot();

</script>

</body>
</html>
